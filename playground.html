<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Playground | Esor</title>
    <meta name="description" content="Playground for Esor framework">
    <link rel="preload stylesheet" href="/assets/style.CrOKd2Ay.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <link rel="icon" type="image/png" href="/logo.png">

    <style>
      .playground-container {
        display: flex;
        height: calc(100vh - 64px); /* Adjust based on header height */
        margin-top: 64px;
      }
      .editor-pane, .preview-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--vp-c-divider);
      }
      .preview-pane {
        border-right: none;
      }
      .pane-header {
        padding: 0.5rem 1rem;
        background-color: var(--vp-c-bg-soft);
        border-bottom: 1px solid var(--vp-c-divider);
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      textarea {
        flex: 1;
        width: 100%;
        resize: none;
        border: none;
        padding: 1rem;
        font-family: monospace;
        background-color: var(--vp-c-bg);
        color: var(--vp-c-text-1);
        outline: none;
        font-size: 14px;
        line-height: 1.5;
      }
      iframe {
        flex: 1;
        width: 100%;
        border: none;
        background-color: white; /* Preview usually needs white bg */
      }
      .run-button {
        padding: 4px 12px;
        background-color: var(--vp-c-brand-1);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
      }
      .run-button:hover {
        background-color: var(--vp-c-brand-2);
      }
      /* Dark mode support for iframe if needed, but usually preview mimics browser default */
      /* Minimal header styles to match site without full JS */
      .VPNav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 20;
        background-color: var(--vp-c-bg);
        border-bottom: 1px solid var(--vp-c-divider);
        height: 64px;
      }
      .VPNavBar {
        height: 64px;
        display: flex;
        align-items: center;
        padding: 0 24px;
      }
      .VPNavBarTitle {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 16px;
        color: var(--vp-c-text-1);
        text-decoration: none;
        margin-right: 32px;
      }
      .VPNavBarTitle img {
        height: 24px;
        margin-right: 8px;
      }
      .VPNavBarMenu {
        display: flex;
        gap: 24px;
      }
      .VPNavBarMenuLink {
        font-size: 14px;
        font-weight: 500;
        color: var(--vp-c-text-1);
        text-decoration: none;
      }
      .VPNavBarMenuLink:hover {
        color: var(--vp-c-brand-1);
      }
    </style>
  </head>
  <body>
    <header class="VPNav">
      <div class="VPNavBar">
        <a class="VPNavBarTitle" href="/">
          <img src="/logo.png" alt="Logo">
          Esor
        </a>
        <nav class="VPNavBarMenu">
          <a class="VPNavBarMenuLink" href="/">Home</a>
          <a class="VPNavBarMenuLink" href="/guide/introduction.html">Guide</a>
          <a class="VPNavBarMenuLink" href="/playground.html" style="color: var(--vp-c-brand-1);">Playground</a>
        </nav>
      </div>
    </header>

    <div class="playground-container">
      <div class="editor-pane">
        <div class="pane-header">
          <span>Code</span>
          <button class="run-button" id="run-btn">Run</button>
        </div>
        <textarea id="code-editor" spellcheck="false"></textarea>
      </div>
      <div class="preview-pane">
        <div class="pane-header">
          <span>Preview</span>
        </div>
        <iframe id="preview-frame"></iframe>
      </div>
    </div>

    <script>
      const defaultCode = `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("hello-world", () => {
  const name = signal("World");

  return html\`
    <div style="font-family: sans-serif; padding: 20px;">
      <h1>Hello \${name}!</h1>
      <input
        value=\${name}
        oninput=\${(e) => name(e.target.value)}
        placeholder="Type your name"
        style="padding: 8px; font-size: 16px;"
      />
    </div>
  \`;
});

// Mount the component to the body
document.body.innerHTML = '<hello-world></hello-world>';
`;

      const editor = document.getElementById('code-editor');
      const preview = document.getElementById('preview-frame');
      const runBtn = document.getElementById('run-btn');

      // Load initial code
      editor.value = localStorage.getItem('esor-playground-code') || defaultCode;

      function updatePreview() {
        const code = editor.value;
        localStorage.setItem('esor-playground-code', code);

        const htmlContent = `
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Preview</title>
    <style>body { margin: 0; }</style>
  </head>
  <body>
    <script type="module">
      ${code}
    <\/script>
  </body>
</html>`;

        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        preview.src = url;
      }

      runBtn.addEventListener('click', updatePreview);

      // Initial run
      updatePreview();

      // Handle Tab in textarea
      editor.addEventListener('keydown', function(e) {
        if (e.key == 'Tab') {
          e.preventDefault();
          var start = this.selectionStart;
          var end = this.selectionEnd;

          // set textarea value to: text before caret + tab + text after caret
          this.value = this.value.substring(0, start) +
            "  " + this.value.substring(end);

          // put caret at right position again
          this.selectionStart = this.selectionEnd = start + 2;
        }
      });

      // Auto-run on Ctrl+Enter or Cmd+Enter
      editor.addEventListener('keydown', function(e) {
          if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
              updatePreview();
          }
      });
    </script>

    <!-- Include dark mode script from index.html to prevent flash of wrong theme if possible,
         though without the full VP app it might just default to one.
         We'll include the inline script. -->
    <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </body>
</html>
