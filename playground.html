<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Playground | Esor</title>
    <meta name="description" content="Playground for Esor framework">
    <link rel="preload stylesheet" href="/assets/style.CrOKd2Ay.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <link rel="icon" type="image/png" href="/logo.png">

    <style>
      .playground-container {
        display: flex;
        height: calc(100vh - 64px); /* Adjust based on header height */
        margin-top: 64px;
      }
      .editor-pane, .preview-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--vp-c-divider);
      }
      .preview-pane {
        border-right: none;
      }
      .pane-header {
        padding: 0.5rem 1rem;
        background-color: var(--vp-c-bg-soft);
        border-bottom: 1px solid var(--vp-c-divider);
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .editor-content {
        flex: 1;
        position: relative;
        min-height: 0;
      }
      #code-editor {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }
      iframe {
        flex: 1;
        width: 100%;
        border: none;
        background-color: white; /* Preview usually needs white bg */
      }
      .run-button {
        padding: 4px 12px;
        background-color: var(--vp-c-brand-1);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
      }
      .run-button:hover {
        background-color: var(--vp-c-brand-2);
      }
      .example-selector {
        padding: 4px 8px;
        background-color: var(--vp-c-bg);
        color: var(--vp-c-text-1);
        border: 1px solid var(--vp-c-divider);
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .header-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      /* Dark mode support for iframe if needed, but usually preview mimics browser default */
      /* Minimal header styles to match site without full JS */
      .VPNav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 20;
        background-color: var(--vp-c-bg);
        border-bottom: 1px solid var(--vp-c-divider);
        height: 64px;
      }
      .VPNavBar {
        height: 64px;
        display: flex;
        align-items: center;
        padding: 0 24px;
      }
      .VPNavBarTitle {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 16px;
        color: var(--vp-c-text-1);
        text-decoration: none;
        margin-right: 32px;
      }
      .VPNavBarTitle img {
        height: 24px;
        margin-right: 8px;
      }
      .VPNavBarMenu {
        display: flex;
        gap: 24px;
      }
      .VPNavBarMenuLink {
        font-size: 14px;
        font-weight: 500;
        color: var(--vp-c-text-1);
        text-decoration: none;
      }
      .VPNavBarMenuLink:hover {
        color: var(--vp-c-brand-1);
      }
    </style>
  </head>
  <body>
    <header class="VPNav">
      <div class="VPNavBar">
        <a class="VPNavBarTitle" href="/">
          <img src="/logo.png" alt="Logo">
          Esor
        </a>
        <nav class="VPNavBarMenu">
          <a class="VPNavBarMenuLink" href="/">Home</a>
          <a class="VPNavBarMenuLink" href="/guide/introduction.html">Guide</a>
          <a class="VPNavBarMenuLink" href="/playground.html" style="color: var(--vp-c-brand-1);">Playground</a>
        </nav>
      </div>
    </header>

    <div class="playground-container">
      <div class="editor-pane">
        <div class="pane-header">
          <span>Code</span>
          <div class="header-controls">
            <select class="example-selector" id="example-selector">
              <option value="hello-world">Hello World</option>
              <option value="counter">Counter</option>
              <option value="todo-list">Todo List</option>
              <option value="form-validation">Form Validation</option>
              <option value="fetch-data">Fetch Data</option>
            </select>
            <button class="run-button" id="run-btn">Run</button>
          </div>
        </div>
        <div class="editor-content">
          <div id="code-editor"></div>
        </div>
      </div>
      <div class="preview-pane">
        <div class="pane-header">
          <span>Preview</span>
        </div>
        <iframe id="preview-frame"></iframe>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/mode-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-monokai.min.js"></script>
    <script>
      const examples = {
        'hello-world': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("hello-world", () => {
  const name = signal("World");

  return html\`
    <div style="font-family: sans-serif; padding: 20px;">
      <h1>Hello \${name}!</h1>
      <input
        value=\${name}
        oninput=\${(e) => name(e.target.value)}
        placeholder="Type your name"
        style="padding: 8px; font-size: 16px;"
      />
    </div>
  \`;
});

document.body.innerHTML = '<hello-world></hello-world>';`,

        'counter': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("counter-app", () => {
  const count = signal(0);

  return html\`
    <div style="font-family: sans-serif; padding: 20px; text-align: center;">
      <h1>Count: \${count}</h1>
      <div style="margin-top: 20px;">
        <button onclick=\${() => count(count() + 1)} style="padding: 10px 20px; margin: 5px; font-size: 16px;">+</button>
        <button onclick=\${() => count(count() - 1)} style="padding: 10px 20px; margin: 5px; font-size: 16px;">-</button>
      </div>
    </div>
  \`;
});

document.body.innerHTML = '<counter-app></counter-app>';`,

        'todo-list': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("todo-list", () => {
  const todos = signal([]);
  const input = signal("");
  const count = signal(0);

  const addTodo = () => {
    const text = input().trim();
    if (text) {
      todos([...todos(), { id: Date.now(), text: text }]);
      count(count() + 1);
      input("");
    }
  };

  const removeTodo = (id) => {
    todos(todos().filter((todo) => todo.id !== id));
    count(count() - 1);
  };

  const renderTodos = () => {
    return todos().map((todo) =>
      \`<li key="\${todo.id}" style="padding: 10px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; margin-bottom: 5px;">
        <span>\${todo.text}</span>
        <button onclick="document.querySelector('todo-list').removeTodo(\${todo.id})" style="cursor: pointer; background: red; color: white; border: none; padding: 5px 10px; border-radius: 3px;">Delete</button>
      </li>\`
    ).join('');
  };

  const component = html\`
    <div style="font-family: sans-serif; padding: 20px;">
      <h2>Todo List</h2>
      <div style="margin-bottom: 20px;">
        <input
          value=\${input}
          oninput=\${(e) => input(e.target.value)}
          onkeyup=\${(e) => e.key === "Enter" && addTodo()}
          placeholder="Add a todo..."
          style="padding: 8px; margin-right: 10px; width: 300px;"
        />
        <button onclick=\${addTodo} style="padding: 8px 16px; cursor: pointer;">Add Todo</button>
      </div>

      <div style="margin-top: 20px;">
        <p>Total: \${count} items</p>
      </div>

      <ul style="list-style: none; padding: 0; margin-top: 20px;" innerHTML=\${renderTodos}></ul>
    </div>
  \`;

  component.removeTodo = removeTodo;
  return component;
});

document.body.innerHTML = '<todo-list></todo-list>';`,

        'form-validation': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("form-app", () => {
  const email = signal("");
  const password = signal("");
  const message = signal("");

  const handleSubmit = (e) => {
    e.preventDefault();
    if (email().length < 3) {
      message("Email too short");
      return;
    }
    if (password().length < 6) {
      message("Password must be at least 6 characters");
      return;
    }
    message("âœ“ Form submitted successfully!");
    setTimeout(() => message(""), 3000);
  };

  return html\`
    <div style="font-family: sans-serif; padding: 20px; max-width: 400px;">
      <h1>Form Validation</h1>
      <form onsubmit=\${handleSubmit}>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px;">Email:</label>
          <input
            value=\${email}
            oninput=\${(e) => email(e.target.value)}
            style="width: 100%; padding: 8px; box-sizing: border-box;"
          />
        </div>
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px;">Password:</label>
          <input
            type="password"
            value=\${password}
            oninput=\${(e) => password(e.target.value)}
            style="width: 100%; padding: 8px; box-sizing: border-box;"
          />
        </div>
        <button type="submit" style="padding: 10px 20px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px;">
          Submit
        </button>
        \${() => message() ? html\`<p style="margin-top: 15px; font-weight: bold;">\${message()}</p>\` : null}
      </form>
    </div>
  \`;
});

document.body.innerHTML = '<form-app></form-app>';`,

        'fetch-data': `import { component, html, signal, onEffect } from "https://unpkg.com/esor/dist/esor.min.js";

component("user-list", () => {
  const users = signal([]);
  const loading = signal(true);
  const error = signal(null);

  onEffect(() => {
    fetch("https://jsonplaceholder.typicode.com/users")
      .then((res) => res.json())
      .then((data) => {
        users(data);
        loading(false);
      })
      .catch((err) => {
        error(err.message);
        loading(false);
      });
  });

  return html\`
    <div style="font-family: sans-serif; padding: 20px;">
      <h1>User List</h1>
      \${() => (loading() ? html\`<p>Loading...</p>\` : null)}
      \${() => error() ? html\`<p>Error: \${error()}</p>\` : null}

      <ul style="list-style: none; padding: 0;">
        \${() =>
          users().map(
            (user) => html\`
              <li key=\${user.id} style="padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; border-radius: 4px;">
                <h3 style="margin: 0 0 5px 0;">\${user.name}</h3>
                <p style="margin: 0; color: #666;">\${user.email}</p>
              </li>
            \`
          )}
      </ul>
    </div>
  \`;
});

document.body.innerHTML = '<user-list></user-list>';`
      };

      const preview = document.getElementById('preview-frame');
      const runBtn = document.getElementById('run-btn');
      const exampleSelector = document.getElementById('example-selector');

      // Initialize Ace Editor
      const editor = ace.edit("code-editor");
      editor.setTheme("ace/theme/monokai");
      editor.session.setMode("ace/mode/javascript");
      editor.setOptions({
        fontSize: "14px",
        showPrintMargin: false,
        enableBasicAutocompletion: true,
        enableLiveAutocompletion: true
      });

      // Load example
      function loadExample(exampleKey) {
        const code = examples[exampleKey] || examples['hello-world'];
        editor.setValue(code, -1);
        localStorage.setItem('esor-playground-last-example', exampleKey);
        updatePreview();
      }

      // Load saved example or default
      const lastExample = localStorage.getItem('esor-playground-last-example') || 'hello-world';
      exampleSelector.value = lastExample;
      loadExample(lastExample);

      // Handle example selection
      exampleSelector.addEventListener('change', (e) => {
        loadExample(e.target.value);
      });

      function updatePreview() {
        const code = editor.getValue();
        localStorage.setItem('esor-playground-code', code);

        const htmlContent = `
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Preview</title>
    <style>body { margin: 0; }</style>
  </head>
  <body>
    <script type="module">
      ${code}
    <\/script>
  </body>
</html>`;

        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        preview.src = url;
      }

      runBtn.addEventListener('click', updatePreview);

      // Auto-run on Ctrl+Enter or Cmd+Enter
      editor.commands.addCommand({
        name: 'runCode',
        bindKey: { win: 'Ctrl-Enter', mac: 'Command-Enter' },
        exec: updatePreview
      });
    </script>

    <!-- Include dark mode script from index.html to prevent flash of wrong theme if possible,
         though without the full VP app it might just default to one.
         We'll include the inline script. -->
    <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </body>
</html>
