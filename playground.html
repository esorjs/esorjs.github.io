<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Playground | Esor</title>
    <meta name="description" content="Playground for Esor framework">
    <link rel="preload stylesheet" href="/assets/style.CrOKd2Ay.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <link rel="icon" type="image/png" href="/logo.png">

    <style>
      .playground-container {
        display: flex;
        height: calc(100vh - 64px); /* Adjust based on header height */
        margin-top: 64px;
      }
      .editor-pane, .preview-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--vp-c-divider);
      }
      .preview-pane {
        border-right: none;
      }
      .pane-header {
        padding: 0.5rem 1rem;
        background-color: var(--vp-c-bg-soft);
        border-bottom: 1px solid var(--vp-c-divider);
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .editor-content {
        flex: 1;
        position: relative;
        min-height: 0;
      }
      #code-editor {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }
      iframe {
        flex: 1;
        width: 100%;
        border: none;
        background-color: white; /* Preview usually needs white bg */
      }
      .run-button {
        padding: 4px 12px;
        background-color: var(--vp-c-brand-1);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
      }
      .run-button:hover {
        background-color: var(--vp-c-brand-2);
      }
      .example-selector {
        padding: 4px 8px;
        background-color: var(--vp-c-bg);
        color: var(--vp-c-text-1);
        border: 1px solid var(--vp-c-divider);
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .header-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      /* Dark mode support for iframe if needed, but usually preview mimics browser default */
      /* Minimal header styles to match site without full JS */
      .VPNav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 20;
        background-color: var(--vp-c-bg);
        border-bottom: 1px solid var(--vp-c-divider);
        height: 64px;
      }
      .VPNavBar {
        height: 64px;
        display: flex;
        align-items: center;
        padding: 0 24px;
      }
      .VPNavBarTitle {
        display: flex;
        align-items: center;
        font-weight: 600;
        font-size: 16px;
        color: var(--vp-c-text-1);
        text-decoration: none;
        margin-right: 32px;
      }
      .VPNavBarTitle img {
        height: 24px;
        margin-right: 8px;
      }
      .VPNavBarMenu {
        display: flex;
        gap: 24px;
      }
      .VPNavBarMenuLink {
        font-size: 14px;
        font-weight: 500;
        color: var(--vp-c-text-1);
        text-decoration: none;
      }
      .VPNavBarMenuLink:hover {
        color: var(--vp-c-brand-1);
      }
    </style>
  </head>
  <body>
    <header class="VPNav">
      <div class="VPNavBar">
        <a class="VPNavBarTitle" href="/">
          <img src="/logo.png" alt="Logo">
          Esor
        </a>
        <nav class="VPNavBarMenu">
          <a class="VPNavBarMenuLink" href="/">Home</a>
          <a class="VPNavBarMenuLink" href="/guide/introduction.html">Guide</a>
          <a class="VPNavBarMenuLink" href="/playground.html" style="color: var(--vp-c-brand-1);">Playground</a>
        </nav>
      </div>
    </header>

    <div class="playground-container">
      <div class="editor-pane">
        <div class="pane-header">
          <span>Code</span>
          <div class="header-controls">
            <select class="example-selector" id="example-selector">
              <option value="hello-world">Hello World</option>
              <option value="counter">Counter</option>
              <option value="todo-list">Todo List</option>
              <option value="form-validation">Form Validation</option>
              <option value="fetch-data">Fetch Data</option>
            </select>
            <button class="run-button" id="run-btn">Run</button>
          </div>
        </div>
        <div class="editor-content">
          <div id="code-editor"></div>
        </div>
      </div>
      <div class="preview-pane">
        <div class="pane-header">
          <span>Preview</span>
        </div>
        <iframe id="preview-frame"></iframe>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/mode-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/theme-monokai.min.js"></script>
    <script>
      const examples = {
        'hello-world': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("hello-world", () => {
  const name = signal("World");

  return html\`
    <div style="font-family: sans-serif; padding: 20px;">
      <h1>Hello \${name}!</h1>
      <input
        value=\${name}
        oninput=\${(e) => name(e.target.value)}
        placeholder="Type your name"
        style="padding: 8px; font-size: 16px;"
      />
    </div>
  \`;
});

document.body.innerHTML = '<hello-world></hello-world>';`,

        'counter': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("counter-app", () => {
  const count = signal(0);
  const increment = () => count(count() + 1);
  const decrement = () => count(count() - 1);
  const reset = () => count(0);

  return html\`
    <div style="font-family: sans-serif; padding: 20px; text-align: center;">
      <h1>Counter: \${count}</h1>
      <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
        <button onclick=\${decrement} style="padding: 10px 20px; font-size: 16px; cursor: pointer;">-</button>
        <button onclick=\${reset} style="padding: 10px 20px; font-size: 16px; cursor: pointer;">Reset</button>
        <button onclick=\${increment} style="padding: 10px 20px; font-size: 16px; cursor: pointer;">+</button>
      </div>
    </div>
  \`;
});

document.body.innerHTML = '<counter-app></counter-app>';`,

        'todo-list': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("todo-app", () => {
  const task1 = signal("Buy groceries");
  const task2 = signal("Walk the dog");
  const task3 = signal("Read a book");
  const done1 = signal(false);
  const done2 = signal(false);
  const done3 = signal(false);

  return html\`
    <div style="font-family: sans-serif; padding: 20px; max-width: 500px;">
      <h1>Simple Todo List</h1>
      <p style="color: #666;">Check off tasks and edit them:</p>

      <div style="margin: 20px 0;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
          <input
            type="checkbox"
            checked=\${done1}
            onchange=\${(e) => done1(e.target.checked)}
          />
          <input
            value=\${task1}
            oninput=\${(e) => task1(e.target.value)}
            placeholder="Task 1"
            style="flex: 1; padding: 8px;"
          />
        </div>

        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
          <input
            type="checkbox"
            checked=\${done2}
            onchange=\${(e) => done2(e.target.checked)}
          />
          <input
            value=\${task2}
            oninput=\${(e) => task2(e.target.value)}
            placeholder="Task 2"
            style="flex: 1; padding: 8px;"
          />
        </div>

        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
          <input
            type="checkbox"
            checked=\${done3}
            onchange=\${(e) => done3(e.target.checked)}
          />
          <input
            value=\${task3}
            oninput=\${(e) => task3(e.target.value)}
            placeholder="Task 3"
            style="flex: 1; padding: 8px;"
          />
        </div>
      </div>

      <p style="margin-top: 20px; font-size: 18px;">
        ✓ Task 1: \${done1} | ✓ Task 2: \${done2} | ✓ Task 3: \${done3}
      </p>
    </div>
  \`;
});

document.body.innerHTML = '<todo-app></todo-app>';`,

        'form-validation': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("form-app", () => {
  const username = signal("");
  const password = signal("");
  const message = signal("");
  const isSuccess = signal(false);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (username().length < 3) {
      message("Username must be at least 3 characters");
      isSuccess(false);
      return;
    }
    if (password().length < 6) {
      message("Password must be at least 6 characters");
      isSuccess(false);
      return;
    }
    message("✓ Form submitted successfully!");
    isSuccess(true);
    setTimeout(() => message(""), 3000);
  };

  return html\`
    <div style="font-family: sans-serif; padding: 20px; max-width: 400px;">
      <h1>Login Form</h1>
      <form onsubmit=\${handleSubmit} style="display: flex; flex-direction: column; gap: 15px;">
        <div>
          <label style="display: block; margin-bottom: 5px;">Username (min 3 chars):</label>
          <input
            value=\${username}
            oninput=\${(e) => username(e.target.value)}
            style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;"
            placeholder="Enter username"
          />
          <p style="margin-top: 5px; font-size: 14px;">Current: \${username}</p>
        </div>
        <div>
          <label style="display: block; margin-bottom: 5px;">Password (min 6 chars):</label>
          <input
            type="password"
            value=\${password}
            oninput=\${(e) => password(e.target.value)}
            style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;"
            placeholder="Enter password"
          />
          <p style="margin-top: 5px; font-size: 14px;">Length: \${() => password().length}</p>
        </div>
        <button type="submit" style="padding: 10px; cursor: pointer; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 4px;">
          Submit
        </button>
        <p style="min-height: 24px; font-weight: bold; color: #333;">
          Status: \${message}
        </p>
      </form>
    </div>
  \`;
});

document.body.innerHTML = '<form-app></form-app>';`,

        'fetch-data': `import { component, html, signal } from "https://unpkg.com/esor/dist/esor.min.js";

component("fetch-app", () => {
  const quote = signal("Click the button to load a joke");
  const loading = signal(false);

  const fetchJoke = async () => {
    loading(true);
    quote("Loading...");
    try {
      const response = await fetch('https://official-joke-api.appspot.com/random_joke');
      const json = await response.json();
      quote(\`\${json.setup} — \${json.punchline}\`);
    } catch (err) {
      quote("Error: Could not load joke. Try again!");
    } finally {
      loading(false);
    }
  };

  return html\`
    <div style="font-family: sans-serif; padding: 20px; max-width: 600px;">
      <h1>Random Joke Generator</h1>
      <p style="color: #666;">Click the button to fetch a random joke from an API</p>

      <button
        onclick=\${fetchJoke}
        style="padding: 12px 24px; cursor: pointer; font-size: 16px; margin: 20px 0; background: #4CAF50; color: white; border: none; border-radius: 4px;"
      >
        Get Random Joke
      </button>

      <div style="min-height: 100px; padding: 20px; background: #f5f5f5; border-radius: 4px; margin-top: 20px;">
        <p style="font-size: 18px; line-height: 1.6; margin: 0;">
          \${quote}
        </p>
      </div>

      <p style="margin-top: 20px; color: #999; font-size: 14px;">
        Status: \${() => loading() ? '⏳ Loading...' : '✓ Ready'}
      </p>
    </div>
  \`;
});

document.body.innerHTML = '<fetch-app></fetch-app>';`
      };

      const preview = document.getElementById('preview-frame');
      const runBtn = document.getElementById('run-btn');
      const exampleSelector = document.getElementById('example-selector');

      // Initialize Ace Editor
      const editor = ace.edit("code-editor");
      editor.setTheme("ace/theme/monokai");
      editor.session.setMode("ace/mode/javascript");
      editor.setOptions({
        fontSize: "14px",
        showPrintMargin: false,
        enableBasicAutocompletion: true,
        enableLiveAutocompletion: true
      });

      // Load example
      function loadExample(exampleKey) {
        const code = examples[exampleKey] || examples['hello-world'];
        editor.setValue(code, -1);
        localStorage.setItem('esor-playground-last-example', exampleKey);
        updatePreview();
      }

      // Load saved example or default
      const lastExample = localStorage.getItem('esor-playground-last-example') || 'hello-world';
      exampleSelector.value = lastExample;
      loadExample(lastExample);

      // Handle example selection
      exampleSelector.addEventListener('change', (e) => {
        loadExample(e.target.value);
      });

      function updatePreview() {
        const code = editor.getValue();
        localStorage.setItem('esor-playground-code', code);

        const htmlContent = `
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Preview</title>
    <style>body { margin: 0; }</style>
  </head>
  <body>
    <script type="module">
      ${code}
    <\/script>
  </body>
</html>`;

        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        preview.src = url;
      }

      runBtn.addEventListener('click', updatePreview);

      // Auto-run on Ctrl+Enter or Cmd+Enter
      editor.commands.addCommand({
        name: 'runCode',
        bindKey: { win: 'Ctrl-Enter', mac: 'Command-Enter' },
        exec: updatePreview
      });
    </script>

    <!-- Include dark mode script from index.html to prevent flash of wrong theme if possible,
         though without the full VP app it might just default to one.
         We'll include the inline script. -->
    <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </body>
</html>
